--------------------------------------------------------------------------------
----------------- 3 - WIDOK INFORMACJI O WSZYSTKICH SEDZIACH -------------------
--------------------------------------------------------------------------------

CREATE OR REPLACE VIEW SEDZIA_INFO AS
SELECT
  SEDZIA_MECZ.ID_SEDZIEGO,
  OSOBA.NAZWISKO,
  OSOBA.IMIE,
  OSOBA.NARODOWOSC,
  KLASA_SEDZIEGO.NAZWA_KLASY AS KLASA_SEDZIEGO,
  TRUNC(MONTHS_BETWEEN(sysdate, OSOBA.DATA_URODZENIA)/12) AS WIEK,
  COUNT (*) AS ILOSC_MECZY  
FROM OSOBA
  JOIN SEDZIA_MECZ
    ON SEDZIA_MECZ.OSOBA_ID_OSOBY = OSOBA.ID_OSOBY
  JOIN KLASA_SEDZIEGO
    ON KLASA_SEDZIEGO.ID_KLASY = SEDZIA_MECZ.KLASA_SEDZIEGO_ID_KLASY
  JOIN MECZ
    ON MECZ.SEDZIA_MECZ_ID_OSOBY_SEDZIA_1 = SEDZIA_MECZ.ID_SEDZIEGO
      OR MECZ.SEDZIA_MECZ_ID_OSOBY_SEDZIA_2 = SEDZIA_MECZ.ID_SEDZIEGO
      OR MECZ.SEDZIA_MECZ_ID_OSOBY_SEDZIA_3 = SEDZIA_MECZ.ID_SEDZIEGO
GROUP BY 
  SEDZIA_MECZ.ID_SEDZIEGO,
  OSOBA.NAZWISKO,
  OSOBA.IMIE,
  OSOBA.NARODOWOSC,
  TRUNC(MONTHS_BETWEEN(sysdate, OSOBA.DATA_URODZENIA)/12),
  KLASA_SEDZIEGO.NAZWA_KLASY
ORDER BY OSOBA.NAZWISKO;

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------